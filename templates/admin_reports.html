{% extends 'admin_base.html' %} {% block title %}Reports{% endblock %} {% block
content %}
<div class="container mt-4">
  <h1 class="text-center mb-4">User Reports</h1>

  <!-- Search Form -->
  <form method="get" class="row g-2 align-items-center mb-4">
    <div class="col-auto">
      <input
        type="text"
        name="search"
        class="form-control"
        placeholder="Search usersâ€¦"
        value="{{ search }}"
      />
    </div>
    <div class="col-auto">
      <button type="submit" class="btn btn-primary">Filter</button>
    </div>
  </form>

  <!-- Download Buttons -->
  <div class="mb-4">
    <a
      href="{{ url_for('admin_routes.download_report', type='course_progress', search=search) }}"
      class="btn btn-outline-primary me-2"
    >
      <i class="fas fa-file-csv"></i> Download Course Progress CSV
    </a>
    <a
      href="{{ url_for('admin_routes.download_report', type='exam_performance', search=search) }}"
      class="btn btn-outline-success me-2"
    >
      <i class="fas fa-file-csv"></i> Download Exam Performance CSV
    </a>
    <a
      href="{{ url_for('admin_routes.download_report', type='special_exams', search=search) }}"
      class="btn btn-outline-warning"
    >
      <i class="fas fa-file-csv"></i> Download Special Exams CSV
    </a>
  </div>

  <!-- Course Progress per User -->
  <h3 class="mb-3">Course Progress by User</h3>
  <table class="table table-bordered table-hover mb-5">
    <thead class="table-light">
      <tr>
        <th>User</th>
        <th>Total Courses</th>
        <th>Avg Progress (%)</th>
      </tr>
    </thead>
    <tbody>
      {% if course_progress_data %} {% for row in course_progress_data %}
      <tr>
        <td>{{ row.user_name }}</td>
        <td>{{ row.total_courses }}</td>
        <td>{{ row.avg_progress }}%</td>
      </tr>
      {% endfor %} {% else %}
      <tr>
        <td colspan="3" class="text-center">No course progress data.</td>
      </tr>
      {% endif %}
    </tbody>
  </table>

  <!-- Exam Performance per User -->
  <h3 class="mb-3">Exam Performance by User</h3>
  <table class="table table-bordered table-hover mb-5">
    <thead class="table-light">
      <tr>
        <th>User</th>
        <th>Total Attempts</th>
        <th>Avg Score (%)</th>
        <th>Successful Attempts</th>
      </tr>
    </thead>
    <tbody>
      {% if exam_performance_data %} {% for row in exam_performance_data %}
      <tr>
        <td>{{ row.user_name }}</td>
        <td>{{ row.total_attempts }}</td>
        <td>{{ row.avg_score }}%</td>
        <td>{{ row.successful_attempts }}</td>
      </tr>
      {% endfor %} {% else %}
      <tr>
        <td colspan="4" class="text-center">No exam performance data.</td>
      </tr>
      {% endif %}
    </tbody>
  </table>

  <!-- Special Exam Records -->
  <h3 class="mb-3">Special Exam Records</h3>
  <table class="table table-bordered table-hover mb-5">
    <thead class="table-light">
      <tr>
        <th>User</th>
        <th>Paper 1 Score</th>
        <th>Paper 1 Status</th>
        <th>Paper 2 Score</th>
        <th>Paper 2 Status</th>
      </tr>
    </thead>
    <tbody>
      {% if special_exam_records %} {% for r in special_exam_records %}
      <tr>
        <td>{{ r.user.first_name }} {{ r.user.last_name }}</td>
        <td>{{ r.paper1_score }}%</td>
        <td>
          {% if r.paper1_passed %}
          <span class="badge bg-success">Passed</span>
          {% else %}
          <span class="badge bg-danger">Failed</span>
          {% endif %}
        </td>
        <td>{{ r.paper2_score }}%</td>
        <td>
          {% if r.paper2_passed %}
          <span class="badge bg-success">Passed</span>
          {% else %}
          <span class="badge bg-danger">Failed</span>
          {% endif %}
        </td>
      </tr>
      {% endfor %} {% else %}
      <tr>
        <td colspan="5" class="text-center">No special exam records.</td>
      </tr>
      {% endif %}
    </tbody>
  </table>
</div>
{% endblock %}
